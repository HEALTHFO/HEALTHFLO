
const TRANSLATIONS = {
    en: {
        app_name: "HealthFlo",
        subtitle: "CLINICAL V3",
        nav_dashboard: "Dashboard",
        nav_health: "Health",
        nav_organs: "Organs",
        nav_labs: "Labs",
        nav_pharmacy: "Pharmacy",
        nav_hospitals: "Hospitals",
        nav_insurance: "Insurance",
        nav_devices: "Devices",
        nav_family: "Family",
        nav_settings: "Settings",
        nav_exit: "Exit",

        // Dashboard & Health
        dash_title: "Patient",
        dash_subtitle: "Twin",
        search_placeholder: "Ask Nurse Agent or Search...",
        health_status_title: "Status & Vitals",
        health_dashboard_title: "Health",
        health_score_title: "Overall Health Score",
        health_ai_title: "AI Health Guardian",
        health_vitals_title: "Live Vitals Monitoring",
        health_organs_title: "Organ System Status",
        health_profile_title: "Complete Profile & Lifestyle",
        health_trends_title: "Health Trends",
        health_meds_title: "Medication Management",
        health_nutrition_title: "Genetics & Nutrition",
        health_actions_title: "Quick Actions",
        health_lab_sync: "Advanced Lab Sync",

        // Profile
        prof_title: "Identity & History",
        prof_header: "Patient Profile",
        prof_card_personal: "Personal Details",
        prof_card_medical: "Medical Resume",
        prof_card_wallet: "Wallet & Finance",

        // Hospital Cards
        hosp_beds: "beds",
        hosp_live_bed: "Live bedboard",
        hosp_min_wait: "min wait",
        hosp_opd_wait: "OPD wait now",
        hosp_occupancy: "Occupancy pulse",
        hosp_occupancy_val: "occupancy",
        hosp_distance: "km away",
        hosp_live_eta: "Live ETA with traffic",
        hosp_cashless: "Cashless",
        hosp_selfpay: "Self-pay",
        hosp_cashless_desk: "Cashless desk",
        hosp_insurance_desk: "Insurance & pre-auth desk",
        hosp_book_opd: "Book OPD",
        hosp_plan_adm: "Plan admission",
        hosp_start_call: "Start call",
        hosp_call_er: "Call ER",
        hosp_tab_services: "Services",
        hosp_tab_packages: "Packages",
        hosp_tab_doctors: "Doctors",
        hosp_tab_pharmacy: "Pharmacy",
        hosp_tab_labs: "Labs",
        hosp_btn_route: "Route",
        hosp_btn_view: "View",
        hosp_btn_emergency: "Emergency",


        // Sections
        sec_vitals: "Live Vitals",
        sec_nutrition: "Nutrition & Minerals",
        sec_labs: "Molecular Diagnostics",
        sec_ai: "AI Analysis",

        // Actions
        btn_diet: "Get Diet Plan",
        btn_scan: "Full Body Scan",
        btn_reports: "Upload Reports",

        // Modes
        mode_medical: "Medical Mode",
        mode_simple: "Simple Mode",

        // Organs
        organ_heart: "Heart",
        organ_brain: "Brain",
        organ_lungs: "Lungs",
        organ_liver: "Liver",
        organ_kidneys: "Kidneys",
        organ_stomach: "Stomach",
        organ_intestines: "Intestines",
        organ_pancreas: "Pancreas",
        organ_gallbladder: "Gallbladder",
        organ_eyes: "Eyes",
        organ_skin: "Skin",
        organ_muscle: "Muscles",
        organ_thyroid: "Thyroid",
        organ_spleen: "Spleen",
        organ_spleen: "Spleen",
        organ_urinary: "Bladder",

        // Tracking
        track_arriving_in: "Arriving in",
        track_med_way: "Medicine on the way",
        track_med_sub: "Your order from Apollo Pharmacy is out for delivery.",
        btn_call: "Call",
        btn_share: "Share Status",
        track_arrived: "Arrived",
        track_partner_arrived: "Partner has arrived",
        track_drone_title: "Emergency Drone Dispatch",
        track_drone_sub: "Carrying AED & First Aid Kit. Landing zone identified.",
        track_ems_title: "Ambulance En Route",
        track_ems_sub: "Priority dispatch for medical emergency.",
        track_lab_title: "Lab Technician Arriving",
        track_lab_sub: "For scheduled blood collection.",
        track_eta: "ETA"
    },
    ta: {
        app_name: "ஹெல்த்ஃப்ளோ",
        subtitle: "கிளினிக்கல் V3",
        nav_dashboard: "முகப்பு",
        nav_health: "சுகாதாரம்",
        nav_organs: "உறுப்புகள்",
        nav_labs: "ஆய்வகம்",
        nav_pharmacy: "மருந்தகம்",
        nav_hospitals: "மருத்துவமனைகள்",
        nav_insurance: "காப்பீடு",
        nav_devices: "கருவிகள்",
        nav_family: "குடும்பம்",
        nav_settings: "அமைப்புகள்",
        nav_exit: "வெளியேறு",

        dash_title: "நோயாளி",
        dash_subtitle: "டிஜிட்டல் இரட்டை",
        search_placeholder: "நர்ஸிடம் கேளுங்கள்...",

        sec_vitals: "உடல் நிலவரம்",
        sec_nutrition: "ஊட்டச்சத்துக்கள்",
        sec_labs: "ஆய்வக முடிவுகள்",
        sec_ai: "AI ஆய்வு",

        btn_diet: "உணவுத் திட்டம்",
        btn_scan: "முழு உடல் ஸ்கேன்",
        btn_reports: "அறிக்கைகளை பதிவேற்றவும்",

        mode_medical: "மருத்துவ முறை",
        mode_simple: "எளிய முறை",

        organ_heart: "இதயம்",
        organ_brain: "மூளை",
        organ_lungs: "நுரையீரல்",
        organ_liver: "கல்லீரல்",
        organ_kidneys: "சிறுநீரகங்கள்",
        organ_stomach: "வயிறு",
        organ_intestines: "குடல்",
        organ_pancreas: "கணையம்",
        organ_gallbladder: "பித்தப்பை",
        organ_eyes: "கண்கள்",
        organ_skin: "தோல்",
        organ_muscle: "தசைகள்",
        organ_thyroid: "தைராய்டு",
        organ_spleen: "மண்ணீரல்",
        organ_urinary: "சிறுநீர்ப்பை"
    },
    hi: {
        app_name: "हेल्थफ़्लो",
        subtitle: "क्लिनिकल V3",
        nav_dashboard: "डैशबोर्ड",
        nav_health: "स्वास्थ्य",
        nav_organs: "अंग",
        nav_labs: "लैब",
        nav_pharmacy: "फार्मेसी",
        nav_hospitals: "अस्पताल",
        nav_insurance: "बीमा",
        nav_devices: "उपकरण",
        nav_family: "परिवार",
        nav_settings: "सेटिंग्स",
        nav_exit: "बाहर निकलें",

        dash_title: "रोगी",
        dash_subtitle: "डिजिटल ट्विन",
        search_placeholder: "नर्स से पूछें...",

        sec_vitals: "लाइव वाइटल्स",
        sec_nutrition: "पोषण और खनिज",
        sec_labs: "नैदानिक जांच",
        sec_ai: "AI विश्लेषण",

        btn_diet: "डाइट प्लान",
        btn_scan: "फुल बॉडी स्कैन",
        btn_reports: "रिपोर्ट अपलोड करें",

        mode_medical: "मेडिकल मोड",
        mode_simple: "सरल मोड",

        organ_heart: "हृदय",
        organ_brain: "मस्तिष्क",
        organ_lungs: "फेफड़े",
        organ_liver: "जिगर",
        organ_kidneys: "गुर्दे",
        organ_stomach: "पेट",
        organ_intestines: "आंत",
        organ_pancreas: "अग्न्याशय",
        organ_gallbladder: "पित्ताशय",
        organ_eyes: "आंखें",
        organ_skin: "त्वचा",
        organ_muscle: "मांसपेशियां",
        organ_thyroid: "थायराइड",
        organ_spleen: "तिल्ली",
        organ_urinary: "मूत्राशय"
    },
    ml: {
        app_name: "ഹെൽത്ത്ഫ്ലോ",
        subtitle: "ക്ലിനിക്കൽ V3",
        nav_dashboard: "ഡാഷ്‌ബോർഡ്",
        nav_health: "ആരോഗ്യം",
        nav_organs: "അവയവങ്ങൾ",
        nav_labs: "ലാബ്",
        nav_pharmacy: "ഫാർമസി",
        nav_hospitals: "ആശുപത്രികൾ",
        nav_insurance: "ഇൻഷുറൻസ്",
        nav_devices: "ഉപകരണങ്ങൾ",
        nav_family: "കുടുംബം",
        nav_settings: "ക്രമീകരണങ്ങൾ",
        nav_exit: "പുറത്തുകടക്കുക",

        dash_title: "രോഗി",
        dash_subtitle: "ഡിജിറ്റൽ ട്വിൻ",
        search_placeholder: "നഴ്സിനോട് ചോദിക്കൂ...",

        sec_vitals: "തത്സമയ വിവരങ്ങൾ",
        sec_nutrition: "പോഷകാഹാരം",
        sec_labs: "രോഗനിർണയം",
        sec_ai: "AI വിശകലനം",

        btn_diet: "ഭക്ഷണക്രമം",
        btn_scan: "സ്കാൻ",
        btn_reports: "റിപ്പോർട്ടുകൾ",

        mode_medical: "മെഡിക്കൽ മോഡ്",
        mode_simple: "ലളിതമായ മോഡ്",

        organ_heart: "ഹൃദയം",
        organ_brain: "തലച്ചോറ്",
        organ_lungs: "ശ്വാകോശം",
        organ_liver: "കരൾ",
        organ_kidneys: "വൃക്കകൾ",
        organ_stomach: "വയർ",
        organ_intestines: "കുടൽ",
        organ_pancreas: "പാൻക്രിയാസ്",
        organ_gallbladder: "പിത്തസഞ്ചി",
        organ_eyes: "കണ്ണുകൾ",
        organ_skin: "ചർമ്മം",
        organ_muscle: "പേശികൾ",
        organ_thyroid: "തൈറോയ്ഡ്",
        organ_spleen: "പ്ലീഹ",
        organ_urinary: "മൂത്രസഞ്ചി"
    },
    kn: {
        app_name: "ಹೆಲ್ತ್‌ಫ್ಲೋ",
        subtitle: "ಕ್ಲಿನಿಕಲ್ V3",
        nav_dashboard: "ಡ್ಯಾಶ್‌ಬೋರ್ಡ್",
        nav_health: "ಆರೋಗ್ಯ",
        nav_organs: "ಅಂಗಗಳು",
        nav_labs: "ಲ್ಯಾಬ್ಸ್",
        nav_pharmacy: "ಔಷಧಾಲಯ",
        nav_hospitals: "ಆಸ್ಪತ್ರೆಗಳು",
        nav_insurance: "ವಿಮೆ",
        nav_devices: "ಸಾಧನಗಳು",
        nav_family: "ಕುಟುಂಬ",
        nav_settings: "ಸೆಟ್ಟಿಂಗ್‌ಗಳು",
        nav_exit: "ನಿರ್ಗಮಿಸಿ",

        dash_title: "ರೋಗಿ",
        dash_subtitle: "ಡಿಜಿಟಲ್ ಟ್ವಿನ್",
        search_placeholder: "ನರ್ಸ್ ಅನ್ನು ಕೇಳಿ...",

        sec_vitals: "ನೇರ ಅಂಕಿಅಂಶಗಳು",
        sec_nutrition: "ಪೋಷಣೆ",
        sec_labs: "ರೋಗನಿರ್ಣಯ",
        sec_ai: "AI ವಿಶ್ಲೇಷಣೆ",

        btn_diet: "ಆಹಾರ ಯೋಜನೆ",
        btn_scan: "ಬಾಡಿ ಸ್ಕ್ಯಾನ್",
        btn_reports: "ವರದಿಗಳು",

        mode_medical: "ವೈದ್ಯಕೀಯ ಮೋಡ್",
        mode_simple: "ಸರಳ ಮೋಡ್",

        organ_heart: "ಹೃದಯ",
        organ_brain: "ಮೆದುಳು",
        organ_lungs: "ಶ್ವಾಸಕೋಶ",
        organ_liver: "ಯಕೃತ್ತು",
        organ_kidneys: "ಮೂತ್ರಪಿಂಡಗಳು",
        organ_stomach: "ಹೊಟ್ಟೆ",
        organ_intestines: "ಕರುಳು",
        organ_pancreas: "ಮೇದೋಜೀರಕ ಗ್ರಂಥಿ",
        organ_gallbladder: "ಪಿತ್ತಕೋಶ",
        organ_eyes: "ಕಣ್ಣುಗಳು",
        organ_skin: "ಚರ್ಮ",
        organ_muscle: "ಸ್ನಾಯುಗಳು",
        organ_thyroid: "ಥೈರಾಯ್ಡ್",
        organ_spleen: "ಗುಲ್ಮ",
        organ_urinary: "ಮೂತ್ರಕೋಶ"
    },
    te: {
        app_name: "హెల్త్‌ఫ్లో",
        subtitle: "క్లినికల్ V3",
        nav_dashboard: "డ్యాష్‌బోర్డ్",
        nav_health: "ఆరోగ్యం",
        nav_organs: "అవయవాలు",
        nav_labs: "ల్యాబ్",
        nav_pharmacy: "ఫార్మసీ",
        nav_hospitals: "ఆసుపత్రులు",
        nav_insurance: "భీమా",
        nav_devices: "పరికరాలు",
        nav_family: "కుటుంబం",
        nav_settings: "అమరికలు",
        nav_exit: "నిష్క్రమించు",

        dash_title: "రోగి",
        dash_subtitle: "డిజిటల్ ట్విన్",
        search_placeholder: "నర్స్ ను అడగండి...",

        sec_vitals: "లైవ్ వైటల్స్",
        sec_nutrition: "పోషకాహారం",
        sec_labs: "రోగనిర్ధారణ",
        sec_ai: "AI విశ్లేషణ",

        btn_diet: "డైట్ ప్లాన్",
        btn_scan: "శరీర స్కాన్",
        btn_reports: "నివేదికలు",

        mode_medical: "వైద్య మోడ్",
        mode_simple: "సాధారణ మోడ్",

        organ_heart: "గుండె",
        organ_brain: "మెదడు",
        organ_lungs: "ఊపిరితిత్తులు",
        organ_liver: "కాలేయం",
        organ_kidneys: "మూత్రపిండాలు",
        organ_stomach: "కడుపు",
        organ_intestines: "ప్రేగులు",
        organ_pancreas: "ప్యాంక్రియాస్",
        organ_gallbladder: "పిత్తాశయం",
        organ_eyes: "కళ్ళు",
        organ_skin: "చర్మం",
        organ_muscle: "కండరాలు",
        organ_thyroid: "థైరాయిడ్",
        organ_spleen: "ప్లీహము",
        organ_urinary: "మూత్రాశయం"
    }
};

// Terminology Dictionary for Complex vs Simple
const TERMINOLOGY = {
    // English defaults (Complex -> Simple)
    en: {
        "Cardiovascular System": "Heart Health",
        "Respiratory System": "Breathing System",
        "Nervous System": "Brain & Nerves",
        "Digestive System": "Digestion",
        "Hepatic System": "Liver Function",
        "Renal System": "Kidney Function",
        "Hypotension": "Low Blood Pressure",
        "Hypertension": "High Blood Pressure",
        "Tachycardia": "Fast Heart Rate",
        "Bradycardia": "Slow Heart Rate",
        "Optimal": "Excellent",
        "Resting Heart Rate": "Resting Pulse",
        "Blood Pressure": "BP Level",
        "O2 Saturation": "Oxygen Level"
    },
    // For other languages, we assume the main translation is already 'simple/common' enough 
    // or we can add specific overrides here if needed.
    // For now, we will fallback to the main TRANSLATIONS object for key terms.
};


class LocalizationManager {
    constructor() {
        this.currentLang = localStorage.getItem('hf-lang') || 'en';
        this.currentMode = localStorage.getItem('hf-mode') || 'medical'; // medical | simple
    }

    setLanguage(lang) {
        if (!TRANSLATIONS[lang]) return;
        this.currentLang = lang;
        localStorage.setItem('hf-lang', lang);
        this.updatePage();
    }

    setMode(mode) {
        this.currentMode = mode;
        localStorage.setItem('hf-mode', mode);
        this.updatePage();
    }

    // Get simple translation
    t(key) {
        const dicta = TRANSLATIONS[this.currentLang];
        return dicta[key] || TRANSLATIONS['en'][key] || key;
    }

    // Get term based on mode
    term(originalTerm) {
        // If simple mode and English, check terminology dict
        if (this.currentMode === 'simple' && this.currentLang === 'en') {
            return TERMINOLOGY.en[originalTerm] || originalTerm;
        }
        // If not English, we assume the translation itself is the term we want.
        // But if we need to translate specific medical terms dynamically:
        // We can check if there's a specific key for this term in TRANSLATIONS
        // e.g. 'organ_heart'

        // Helper: Check if the term matches a known organ key
        const lower = originalTerm.toLowerCase();
        if (TRANSLATIONS[this.currentLang][`organ_${lower}`]) {
            return TRANSLATIONS[this.currentLang][`organ_${lower}`];
        }

        return originalTerm;
    }

    // Updates all elements with data-i18n attribute
    updatePage() {
        document.querySelectorAll('[data-i18n]').forEach(el => {
            const key = el.getAttribute('data-i18n');
            const translation = this.t(key);

            if (el.tagName === 'INPUT' && el.getAttribute('placeholder')) {
                el.placeholder = translation;
            } else {
                el.innerText = translation;
            }
        });

        // Loop through text nodes for detailed medical terms? 
        // This is risky/hard. Better to use targeted updates.

        // Update "Mode" indicator if exists
        const modeLabel = document.getElementById('mode-display');
        if (modeLabel) modeLabel.innerText = this.t(`mode_${this.currentMode}`);

        // Trigger a re-render of dynamic content if available
        if (window.renderOrganTray) window.renderOrganTray();
        if (window.updateUI && window.activeOrgan) window.updateUI(window.activeOrgan);
    }
}

const LOCALE = new LocalizationManager();

// Global Access
window.setLang = (lang) => LOCALE.setLanguage(lang);
window.setMode = (mode) => LOCALE.setMode(mode);
window.t = (key) => LOCALE.t(key);
window.term = (text) => LOCALE.term(text);

document.addEventListener('DOMContentLoaded', () => {
    LOCALE.updatePage();
});
